<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html><head></head><body>

















<main>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput">
<h1>Noise Exercise<a rel="noopener" class="anchor-link" href="#Noise-Exercise">&#182;</a></h1><p>This notebook contains an exercise divided into six (very interconnected) parts.
For each part, you need to write a bit of code, and the cells towards the end of the notebook contain calls that generate images. Use this to check whether your implementations work.</p>
<p>When you have completed all parts, please answer the questions at the end of this notebook. Your answers should just be added to the notebook, and the entire notebook is submitted as a hand-in by exporting it as HTML and then uploading the HTML to the assignment in Learn.</p>
<h3>Making this exercise easier<a rel="noopener" class="anchor-link" href="#Making-this-exercise-easier">&#182;</a></h3><p>Note that Part 4 is non-mandatory.</p>
<h3>Making this exercise harder<a rel="noopener" class="anchor-link" href="#Making-this-exercise-harder">&#182;</a></h3><p>To make this exercise more challenging consider one of the following <em>non-mandatory</em> extensions.</p>
<ul>
<li>implement one or more different noise functions, e.g. Perlin&#39;s noise function:<br/>
<a rel="noopener" href="https://findit.dtu.dk/en/catalog/5a2ff7225010df33b0055c9c">https://findit.dtu.dk/en/catalog/5a2ff7225010df33b0055c9c</a>
or sparse convolution noise:<br/>
<a rel="noopener" href="https://backend.orbit.dtu.dk/ws/portalfiles/portal/4164648/imm5481.pdf">https://backend.orbit.dtu.dk/ws/portalfiles/portal/4164648/imm5481.pdf</a></li>
<li>implement Bridson&#39;s algorithm for fast Poisson Disk Sampling:<br/>
<a rel="noopener" href="https://www.cs.ubc.ca/~rbridson/docs/bridson-siggraph07-poissondisk.pdf">https://www.cs.ubc.ca/~rbridson/docs/bridson-siggraph07-poissondisk.pdf</a></li>
</ul>
<h4>Implementation details<a rel="noopener" class="anchor-link" href="#Implementation-details">&#182;</a></h4><p>The libraries needed are probably part of your distribution, but you will need to install PyGEL. For most users, the best way to do that is via <code>pip</code>:</p>
<p><code>pip install --user pygel3d</code></p>
<p>Chances are that <code>numpy</code> and <code>numba</code> are already installed, but, otherwise, you can also get those using <code>pip</code>. <code>plotly</code>is installed as a dependency of <code>pygel3d</code>.</p>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[&#160;]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">pip</span> install --user pygel3d
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput">
<h2>Initialization in the block below<a rel="noopener" class="anchor-link" href="#Initialization-in-the-block-below">&#182;</a></h2>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[&#160;]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">cos</span><span class="p">,</span> <span class="n">sin</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="n">sqrt</span><span class="p">,</span> <span class="n">exp</span><span class="p">,</span> <span class="n">atan2</span><span class="p">,</span> <span class="n">log</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">ndindex</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">ndarray</span><span class="p">,</span> <span class="n">dot</span><span class="p">,</span> <span class="n">empty</span><span class="p">,</span> <span class="n">linspace</span><span class="p">,</span> <span class="n">clip</span><span class="p">,</span> <span class="nb">abs</span><span class="p">,</span> <span class="n">ceil</span><span class="p">,</span> <span class="n">floor</span><span class="p">,</span> <span class="n">zeros</span><span class="p">,</span> <span class="n">repeat</span><span class="p">,</span> <span class="n">ndenumerate</span>
<span class="kn">from</span> <span class="nn">numpy.linalg</span> <span class="kn">import</span> <span class="n">norm</span>
<span class="kn">from</span> <span class="nn">numpy.random</span> <span class="kn">import</span> <span class="n">normal</span>
<span class="kn">from</span> <span class="nn">numpy.fft</span> <span class="kn">import</span> <span class="n">fft2</span><span class="p">,</span><span class="n">fftshift</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">uniform</span>
<span class="kn">from</span> <span class="nn">numba</span> <span class="kn">import</span> <span class="n">njit</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span>
<span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>
<span class="kn">from</span> <span class="nn">pygel3d</span> <span class="kn">import</span> <span class="n">hmesh</span><span class="p">,</span> <span class="n">jupyter_display</span> <span class="k">as</span> <span class="n">jd</span>
<span class="n">jd</span><span class="o">.</span><span class="n">set_export_mode</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">vec2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Convert two numbers to a 2D numpy array &#39;&#39;&#39;</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">empty</span><span class="p">((</span><span class="mi">2</span><span class="p">,))</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span>
    <span class="k">return</span> <span class="n">v</span>

<span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">vec3</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Convert three numbers to a 2D numpy array &#39;&#39;&#39;</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">empty</span><span class="p">((</span><span class="mi">3</span><span class="p">,))</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">z</span>
    <span class="k">return</span> <span class="n">v</span>

<span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">vec4</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">w</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Convert four numbers to a 2D numpy array &#39;&#39;&#39;</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">empty</span><span class="p">((</span><span class="mi">4</span><span class="p">,))</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">z</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">w</span>
    <span class="k">return</span> <span class="n">v</span>

<span class="k">def</span> <span class="nf">Fourier_transform</span><span class="p">(</span><span class="n">img</span><span class="p">):</span>
    <span class="n">ft</span> <span class="o">=</span> <span class="n">fft2</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
    <span class="n">ft</span> <span class="o">=</span> <span class="n">fftshift</span><span class="p">(</span><span class="n">ft</span><span class="p">)</span>
    <span class="n">ft_mag</span> <span class="o">=</span> <span class="n">clip</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">ft</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="mi">256</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ft_mag</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput">
<h2>Insert code in blocks below<a rel="noopener" class="anchor-link" href="#Insert-code-in-blocks-below">&#182;</a></h2>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[&#160;]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">init_noise_vectors</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Initialize random vectors used to generate the 2D sine waves that</span>
<span class="sd">    form the basis of the noise. The parameter N is the number of sine </span>
<span class="sd">    waves used. The function returns an Nx4 matrix each row of which </span>
<span class="sd">    retpresents a wave contributing to the noise.&#39;&#39;&#39;</span>
    <span class="n">noise_waves</span> <span class="o">=</span> <span class="n">empty</span><span class="p">((</span><span class="n">N</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
    <span class="c1">#--- Part 1: Insert code below that initializes noise_waves</span>

    <span class="n">sigma</span> <span class="o">=</span> <span class="mi">5</span> 

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
       <span class="n">phase_shift</span> <span class="o">=</span> <span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">)</span>
       <span class="n">chi</span> <span class="o">=</span> <span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">sigma</span><span class="p">)</span>
       <span class="n">weight</span> <span class="o">=</span> <span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="nb">pow</span><span class="p">(</span><span class="n">chi</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="nb">pow</span><span class="p">(</span><span class="n">sigma</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>

       <span class="n">noise_waves</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">vec4</span><span class="p">((</span><span class="mi">3</span><span class="o">*</span><span class="n">sigma</span><span class="o">+</span><span class="n">chi</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">i</span><span class="o">/</span><span class="n">N</span><span class="p">),(</span><span class="mi">3</span><span class="o">*</span><span class="n">sigma</span><span class="o">+</span><span class="n">chi</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">i</span><span class="o">/</span><span class="n">N</span><span class="p">),</span><span class="n">phase_shift</span><span class="p">,</span><span class="n">weight</span><span class="p">)</span>

    <span class="c1">#--- End of Part 1</span>
    <span class="k">return</span> <span class="n">noise_waves</span>

<span class="n">WAVES</span> <span class="o">=</span> <span class="n">init_noise_vectors</span><span class="p">(</span><span class="mi">90</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">WAVES</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[&#160;]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">noise</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Noise function. Simply sums a number of sine functions&#39;&#39;&#39;</span>
    <span class="n">I</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="c1">#--- Part 2: Insert code below that sums waves. Store sum in I</span>

    <span class="k">for</span> <span class="n">waves</span> <span class="ow">in</span> <span class="n">WAVES</span><span class="p">:</span>
        <span class="n">I</span><span class="o">+=</span> <span class="n">waves</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">dot</span><span class="p">(</span><span class="n">vec2</span><span class="p">(</span><span class="n">waves</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">waves</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="n">waves</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>


    <span class="n">I</span> <span class="o">=</span> <span class="n">I</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">WAVES</span><span class="p">)</span>

    <span class="c1">#--- End of Part 2</span>
    <span class="k">return</span> <span class="n">I</span>


<span class="n">a</span> <span class="o">=</span> <span class="n">vec2</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>

<span class="n">noise</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[&#160;]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">turbulence</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">octaves</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Add octaves of noise to produce a turbulence-like result. Returns </span>
<span class="sd">    a single number which is the intensity of the turbulence.&#39;&#39;&#39;</span>
    <span class="n">I</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1">#--- Part 3: Insert code that sums octaves of noise producing &quot;turbulence&quot;</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">octaves</span><span class="p">):</span>
        <span class="n">I</span> <span class="o">+=</span> <span class="mi">1</span><span class="o">/</span><span class="nb">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">noise</span><span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="o">*</span><span class="n">x</span><span class="p">)</span>

    <span class="c1">#--- End of Part 3</span>
    <span class="k">return</span> <span class="n">I</span>

<span class="n">turbulence</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[&#160;]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">bias</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
    <span class="n">bias</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">log</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">/</span><span class="n">log</span><span class="p">(</span><span class="mf">0.5</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">bias</span>

<span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">gain</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="n">gain</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">:</span>
        <span class="n">gain</span> <span class="o">=</span> <span class="n">bias</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">gain</span> <span class="o">=</span> <span class="mi">1</span><span class="o">-</span><span class="n">bias</span><span class="p">(</span><span class="mi">2</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>

    <span class="k">return</span> <span class="n">gain</span>


<span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">periodic_fun</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">scale</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;This function combines noise and periodic functions to produce an interesting image/texture.&#39;&#39;&#39;</span>
    <span class="n">I</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">freq</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="c1">#--- Part 4: go crazy (non-mandatory)</span>

    <span class="n">noiseValue</span> <span class="o">=</span> <span class="n">noise</span><span class="p">(</span><span class="n">t</span><span class="o">*</span><span class="n">freq</span><span class="p">)</span> <span class="o">*</span> <span class="n">scale</span>
    
    
    <span class="n">I</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">noiseValue</span><span class="p">)</span> <span class="o">+</span> <span class="n">sin</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">noiseValue</span><span class="p">)</span> <span class="o">+</span> <span class="n">turbulence</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

    <span class="n">I</span> <span class="o">=</span> <span class="n">I</span> <span class="o">-</span> <span class="n">floor</span><span class="p">(</span><span class="n">noiseValue</span><span class="p">)</span>

    <span class="n">I</span> <span class="o">=</span> <span class="p">(</span><span class="n">I</span><span class="o">+</span><span class="n">bias</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">))</span><span class="o">*</span><span class="n">gain</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)))</span>

    <span class="c1">#--- End of Part 4</span>
    <span class="k">return</span> <span class="n">I</span>
</pre></div>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[&#160;]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">noise_grad</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Gradient of noise function computed analytically&#39;&#39;&#39;</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">vec2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1">#--- Part 5: Sum gradients of each wave contributing to noise</span>

    <span class="k">for</span> <span class="n">waves</span> <span class="ow">in</span> <span class="n">WAVES</span><span class="p">:</span>
        <span class="c1">#Calculate gradient</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">dot</span><span class="p">(</span><span class="n">vec2</span><span class="p">(</span><span class="n">waves</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">waves</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="n">waves</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        <span class="n">du_dx1</span> <span class="o">=</span> <span class="n">waves</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">du_dy1</span> <span class="o">=</span> <span class="n">waves</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        
        <span class="n">df_dx1</span> <span class="o">=</span> <span class="n">waves</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">du_dx1</span><span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
        <span class="n">df_dy1</span> <span class="o">=</span> <span class="n">waves</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">du_dy1</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>

        <span class="n">g</span> <span class="o">+=</span> <span class="n">vec2</span><span class="p">(</span><span class="n">df_dx1</span><span class="p">,</span><span class="n">df_dy1</span><span class="p">)</span>
        
    <span class="c1">#Normalize</span>
    <span class="n">g</span> <span class="o">/=</span> <span class="nb">len</span><span class="p">(</span><span class="n">WAVES</span><span class="p">)</span>
    <span class="c1">#--- End of Part 5</span>
    <span class="k">return</span> <span class="n">g</span>
</pre></div>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[&#160;]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">Poisson_Disk_Sampling</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Create a distribution of N points such that no two points are </span>
<span class="sd">    closer than R.&#39;&#39;&#39;</span>
    <span class="n">N</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">R</span> <span class="o">=</span> <span class="mf">0.085</span>	
    <span class="n">pts</span> <span class="o">=</span> <span class="n">empty</span><span class="p">((</span><span class="n">N</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
    <span class="c1">#--- Part 6: Fill the array with points abiding by ||pts[i]-pts[j]||&gt;=R</span>

    <span class="n">number_of_generated_points</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">get_random_point</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">vec2</span><span class="p">(</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">is_valid</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">[:</span><span class="n">number_of_generated_points</span><span class="p">]:</span>
            <span class="k">if</span><span class="p">(</span><span class="n">norm</span><span class="p">(</span><span class="n">point</span> <span class="o">-</span> <span class="n">p</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">R</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>
        

    <span class="k">while</span> <span class="n">number_of_generated_points</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">:</span>
        <span class="n">new_point</span> <span class="o">=</span> <span class="n">get_random_point</span><span class="p">()</span>
        <span class="k">if</span><span class="p">(</span><span class="n">is_valid</span><span class="p">(</span><span class="n">new_point</span><span class="p">)):</span>
            <span class="n">pts</span><span class="p">[</span><span class="n">number_of_generated_points</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_point</span>
            <span class="n">number_of_generated_points</span> <span class="o">+=</span> <span class="mi">1</span>


    <span class="c1">#--- End of Part 6</span>
    <span class="k">return</span> <span class="n">pts</span><span class="p">,</span> <span class="n">R</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput">
<h2>Helper functions below<a rel="noopener" class="anchor-link" href="#Helper-functions-below">&#182;</a></h2>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[&#160;]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">V</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">noise_scale</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; V returns a curl noise vector field. In 2D this is just</span>
<span class="sd">    a 90 degree turn of the gradient of the noise.&#39;&#39;&#39;</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">noise_scale</span> <span class="o">*</span> <span class="n">x</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">noise_grad</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">gh</span> <span class="o">=</span> <span class="n">vec2</span><span class="p">(</span><span class="o">-</span><span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">gh</span>

<span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">Rand</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">noise_scale</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Perform a random step from x in a random direction.&#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">dt</span> <span class="o">*</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">vec2</span><span class="p">(</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">),</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">))</span>

<span class="nd">@njit</span>
<span class="k">def</span> <span class="nf">RK4</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">noise_scale</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Perform one Runge-Kutta 4th order step of length dt from x along the curl noise vector field&#39;&#39;&#39;</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">V</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">noise_scale</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">V</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">a</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">noise_scale</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">V</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">b</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">noise_scale</span><span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">V</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="n">c</span><span class="p">,</span> <span class="n">noise_scale</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">b</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">c</span><span class="o">+</span><span class="n">d</span><span class="p">)</span><span class="o">/</span><span class="mi">6</span>


<span class="k">def</span> <span class="nf">show_function_and_spectrum</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">scale</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Display image of function together with Fourier spectrum&#39;&#39;&#39;</span>
    <span class="n">dim</span> <span class="o">=</span> <span class="mi">1024</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">empty</span><span class="p">((</span><span class="n">dim</span><span class="p">,</span><span class="n">dim</span><span class="p">))</span>
    <span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="n">scale</span><span class="o">/</span><span class="n">dim</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="n">ndindex</span><span class="p">((</span><span class="n">dim</span><span class="p">,</span><span class="n">dim</span><span class="p">)):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">s</span><span class="o">*</span><span class="n">vec2</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
        <span class="n">img</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">fig1</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">800</span><span class="p">)</span>
    <span class="n">fig2</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">Fourier_transform</span><span class="p">(</span><span class="n">img</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">800</span><span class="p">)</span>
    <span class="n">fig1</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">fig2</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">show_function</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">scale</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Display image of function fun&#39;&#39;&#39;</span>
    <span class="n">dim</span> <span class="o">=</span> <span class="mi">1024</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">empty</span><span class="p">((</span><span class="n">dim</span><span class="p">,</span><span class="n">dim</span><span class="p">))</span>
    <span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">dim</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="n">ndindex</span><span class="p">((</span><span class="n">dim</span><span class="p">,</span><span class="n">dim</span><span class="p">)):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">s</span><span class="o">*</span><span class="n">vec2</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
        <span class="n">img</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">800</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">show_height_map</span><span class="p">(</span><span class="n">fun</span><span class="p">,</span> <span class="n">scale</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Display function as a height map rendered as a 3D mesh.&#39;&#39;&#39;</span>
    <span class="n">dim</span> <span class="o">=</span> <span class="mi">256</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">ndarray</span><span class="p">((</span><span class="n">dim</span><span class="p">,</span><span class="n">dim</span><span class="p">))</span>
    <span class="n">s</span> <span class="o">=</span> <span class="p">(</span><span class="n">scale</span><span class="o">/</span><span class="n">dim</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="n">ndindex</span><span class="p">((</span><span class="n">dim</span><span class="p">,</span><span class="n">dim</span><span class="p">)):</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">s</span><span class="o">*</span><span class="n">vec2</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
        <span class="n">img</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">fun</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">hmesh</span><span class="o">.</span><span class="n">Manifold</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="n">ndindex</span><span class="p">((</span><span class="n">dim</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">dim</span><span class="o">-</span><span class="mi">1</span><span class="p">)):</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="n">vec3</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">s</span><span class="p">,</span><span class="n">j</span><span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="n">img</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">])</span>
        <span class="n">p1</span> <span class="o">=</span> <span class="n">vec3</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">s</span><span class="p">,</span><span class="n">j</span><span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="n">img</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="p">])</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="n">vec3</span><span class="p">((</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">s</span><span class="p">,(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="n">img</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">p3</span> <span class="o">=</span> <span class="n">vec3</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">s</span><span class="p">,(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">s</span><span class="p">,</span> <span class="n">img</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">m</span><span class="o">.</span><span class="n">add_face</span><span class="p">([</span><span class="n">p0</span><span class="p">,</span> <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">])</span>
    <span class="n">hmesh</span><span class="o">.</span><span class="n">stitch</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
    <span class="n">hmesh</span><span class="o">.</span><span class="n">triangulate</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
    <span class="n">jd</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">show_PDS</span><span class="p">():</span>
    <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
    <span class="n">pts</span><span class="p">,</span><span class="n">R</span> <span class="o">=</span> <span class="n">Poisson_Disk_Sampling</span><span class="p">()</span>
    <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">pts</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">pts</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">800</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">scaleanchor</span><span class="o">=</span><span class="s2">&quot;x&quot;</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">domain</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">domain</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">trace_curl_noise</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">anim</span>
    <span class="n">N</span> <span class="o">=</span> <span class="mi">256</span>
    <span class="n">delta_x</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">pi</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">delta_y</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">pi</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">Ny</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ceil</span><span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">N</span><span class="o">/</span><span class="n">delta_y</span><span class="p">)))</span>
    <span class="n">Nx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Ny</span> <span class="o">*</span> <span class="n">delta_y</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">ndindex</span><span class="p">((</span><span class="n">Nx</span><span class="p">,</span><span class="n">Ny</span><span class="p">))))</span>
    <span class="n">vec</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">vec</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,:]</span> <span class="o">=</span> <span class="n">array</span><span class="p">([</span> <span class="n">vec2</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="p">(</span><span class="n">j</span><span class="o">%</span><span class="k">2</span>)*delta_x,(j+0.5)*delta_y) / Nx for i,j in ndindex((Nx,Ny))])
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">100</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
            <span class="n">vec</span><span class="p">[</span><span class="n">t</span><span class="p">,</span><span class="n">i</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">RK4</span><span class="p">(</span><span class="n">vec</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">,:],</span> <span class="n">dt</span><span class="o">=</span><span class="mf">0.005</span><span class="p">,</span> <span class="n">noise_scale</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">frames</span> <span class="o">=</span> <span class="n">repeat</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">)],</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">px</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">vec</span><span class="p">[:,:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">y</span><span class="o">=</span><span class="n">vec</span><span class="p">[:,:,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">animation_frame</span><span class="o">=</span><span class="n">frames</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">domain</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">]</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">layout</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">domain</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">]</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput">
<h1>Test your code using the functions below<a rel="noopener" class="anchor-link" href="#Test-your-code-using-the-functions-below">&#182;</a></h1>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[&#160;]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Having solved Part 1 and 2 you should be able to generate</span>
<span class="c1"># noise images. The code below tests your implementation by</span>
<span class="c1"># showing the noise and its spectrum at two different scales</span>
<span class="c1"># Feel free to experiment with the scaling. </span>
<span class="c1">#---</span>
<span class="n">show_function_and_spectrum</span><span class="p">(</span><span class="n">noise</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">show_function_and_spectrum</span><span class="p">(</span><span class="n">noise</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[&#160;]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Having solved Part 3, you can generate a turbulence height map</span>
<span class="c1"># Test it using the function below. </span>
<span class="c1">#---</span>
<span class="n">show_height_map</span><span class="p">(</span><span class="n">turbulence</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[&#160;]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Having solved Part 4, you can use the function below to show your</span>
<span class="c1"># periodic pattern. </span>
<span class="c1">#---</span>
<span class="n">show_function</span><span class="p">(</span><span class="n">periodic_fun</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[&#160;]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Having solved Part 5, you can trace particles using curl noise. </span>
<span class="c1">#---</span>
<span class="n">trace_curl_noise</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
</div><div class="jp-Cell jp-CodeCell jp-Notebook-cell jp-mod-noOutputs">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea">
<div class="jp-InputPrompt jp-InputArea-prompt">In&#160;[&#160;]:</div>
<div class="jp-CodeMirrorEditor jp-Editor jp-InputArea-editor">
<div class="cm-editor cm-s-jupyter">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1"># Having solved Part 6, you can show a Poisson disk sampling using</span>
<span class="c1"># the code below. </span>
<span class="n">show_PDS</span><span class="p">()</span>

<span class="n">a</span><span class="o">=</span> <span class="n">vec2</span><span class="p">(</span><span class="mf">50.658</span><span class="p">,</span><span class="mf">87.8189</span><span class="p">)</span>
<span class="n">b</span><span class="o">=</span> <span class="n">vec2</span><span class="p">(</span><span class="mf">49.906</span><span class="p">,</span> <span class="mf">87.055</span><span class="p">)</span>

<span class="n">norm</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput">
<h1>Questions<a rel="noopener" class="anchor-link" href="#Questions">&#182;</a></h1><ul>
<li>Discuss the extent to which the noise function fulfills the desirable properties of noise (bandlimited, stationary, anisotropic)</li>
<li>Regarding turbulence, explain why the scaling of the noise octaves must decrease as the frequency goes up.</li>
<li>When advecting particles using curl noise, explain why the particles don&#39;t bunch up or disperse over time.</li>
<li>Explain why the Poisson disk sampling becomes extremely slow when the maximum number of points that the domain can accommodate is approached.</li>
<li>Explain how curl noise can be used to generate the same type of point pattern as Poisson Disk Sampling.</li>
</ul>
</div>
</div>
</div>
</div>
<div class="jp-Cell jp-MarkdownCell jp-Notebook-cell">
<div class="jp-Cell-inputWrapper">
<div class="jp-Collapser jp-InputCollapser jp-Cell-inputCollapser">
</div>
<div class="jp-InputArea jp-Cell-inputArea"><div class="jp-InputPrompt jp-InputArea-prompt">
</div><div class="jp-RenderedHTMLCommon jp-RenderedMarkdown jp-MarkdownOutput">
<ol>
<li><p>The sum of sines noise function used in this notebook is <font color="green"><em>bandlimited</em></font>. We want to restrict our noise function into a certain frequence range, otherwise the noise function would run amok outside of our desired frequency. In theory, a bandlimited signal should have zero energy outside the specified range. However, we can settle for some very low amount of energy outside of our range. We can see this feature of the noise function, as the colors do not go past a certain threshold value of (-0.2,0.2). Our noise function displays <font color="green"><em>anisotropy</em></font> because in general the sum of sines noise function is anisotropic. It is, however difficult to observe anisotropy, in general, when we implement lattice like noise functions. To observe anisotropy in greater detail, we must rotate the generated noise image. Our noise function is also <font color="green"><em>stationary</em></font> which means the random patterns in one patch aren&#39;t completely different from other patches. This can be observed in the generated noise image if we strain our eyes hard enough.</p>
</li>
<li><p>We would like to decrease the scaling for each octave because it allows us to generate finer details to our noise. As an example, we could try to think of generating a terrain: The first layer of noise should create rough variations in the initially flat surface, the next layer could add details like mountains/hills and the third layer might create small pertubations in the surface of the mountains to create a rough/weatherd looking surface and so on. If we had kept the scaling the same for all octaves, we would not be able to achive the same amount of details. We achieve this by adjusting the size of the patterns using powers of 2. We need to be careful though, because generating more octaves (which are done in a loop), takes longer time to compute.</p>
</li>
<li><p>Curl noise is a type of vector field that is divergence-free. Divergence-free means that there are no so-called &quot;sources&quot; or &quot;sinks&quot; where particles appear to bunch up. Thus, the particle density stays the same over time. In simple terms, the flow created by curl noise neither converges nor diverges significantly. The <font color="yellow"><em>V</em></font> function in the code computes the curl noise vector field. When particles are advected using this curl noise, they essentially follow the local rotation of the noise gradient. This results in a smooth and swirling motion without significant convergence or divergence.</p>
</li>
<li><p>As we increase the number of points in the domain we also increase the probability that two points will be too close to each other. Thus for each point we add it becomes harder and harder to &quot;fit&quot; it into the domain without violating the proximity boundaries. Meaning we need to sample an increasing amout of coordinates to find an appropriate one for the next point we want to add.</p>
</li>
<li><p>The &quot;jittering&quot;, displacement of points, can be done using a method called Curl Noise (Bridson et al.). Suppose we allowed our points to move freely along random vectors, they would surely, cross paths with each other and overlap. In our implementation of noise, we do not desire this. We also want our points to jitter freely (so as to not appear under the influence of a controlling function), and still not get caught in sinks or sources where all points appear to gather/disappear. Therefore, in Curl Noise Jittering, we implement what is called a <font color="yellow"><em>jitter radius</em></font>. We want our points to move freely, but also make sure that no two points cross each other&#39;s jitter radius. Thus, as the points begin their motion, whenever they approach another point or more specifically, the distance between them begins growing shorter than their jitter radius, they always do a shy <em>curling</em> motion and begin changing directions. This is almost similar to Poisson Disc Sampling which also uses a radius parameter to force points from being too close to each other.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
</main>


<script type="module" src="https://s.brightspace.com/lib/bsi/20.24.1-233/unbundled/mathjax.js"></script><script type="text/javascript">document.addEventListener('DOMContentLoaded', function() {
					if (document.querySelector('math') || /\$\$|\\\(|\\\[|\\begin{|\\ref{|\\eqref{/.test(document.body.innerHTML)) {
						document.querySelectorAll('mspace[linebreak="newline"]').forEach(elm => {
							elm.setAttribute('style', 'display: block; height: 0.5rem;');
						});

						window.D2L.MathJax.loadMathJax({
							'outputScale': 1.5,
							'renderLatex': true
						});
					}
				});</script><script type="module" src="https://s.brightspace.com/lib/bsi/20.24.1-233/unbundled/prism.js"></script><script type="text/javascript">document.addEventListener('DOMContentLoaded', function() {
					document.querySelectorAll('.d2l-code').forEach(code => {
						window.D2L.Prism.formatCodeElement(code);
					});
				});</script></body></html>